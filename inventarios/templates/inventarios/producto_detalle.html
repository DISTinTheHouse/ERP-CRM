{% extends 'base.html' %}

{% block content %}
{% load custom_filters %}

<div class="container mt-4">
  <h3 class="mb-3">{{ producto.descripcion }}</h3>

  <div class="mb-4">
    <p><strong>SKU:</strong> {{ producto.sku }}</p>
    <p><strong>Clasificación:</strong> {{ producto.clasificacion|default:"No clasificado" }}</p>
    <p><strong>Tipo:</strong> {{ producto.get_tipo_display|default:"Sin tipo" }}</p>
    <p><strong>Stock Actual en Sistema:</strong> {{ producto.stock_actual }}</p>
  </div>

  <hr>

  <h5>Movimientos de Inventario</h5>

  {% if movimientos %}
    <table class="table table-striped mt-3">
      <thead class="table-light">
        <tr>
          <th>Fecha</th>
          <th>Tipo de Movimiento</th>
          <th>Cantidad</th>
          <th>Referencia</th>
          <th>Almacén</th>
        </tr>
      </thead>
      <tbody>
        {% for movimiento in movimientos %}
          <tr>
            <td>{{ movimiento.fecha|date:"d/m/Y H:i" }}</td>
            <td>{{ movimiento.get_tipo_display }}</td>
            <td>{{ movimiento.cantidad }}</td>
            <td>{{ movimiento.referencia|default:"-" }}</td>
            <td>{{ movimiento.almacen.nombre|default:"-" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="mt-4">
      <p><strong>Existencia basada en movimientos:</strong> 
      {{ movimientos|sum_movimientos }}</p>
    </div>

  {% else %}
    <div class="alert alert-info">
      No hay movimientos de inventario registrados para este producto.
    </div>
  {% endif %}
</div>
{% endblock %}
